{% extends "layout.html" %}
{% block content %}

<style>
    /* Top Navigation for Student Dashboard */
    .student-topbar {
        background: linear-gradient(135deg, rgba(92,107,255,0.15), rgba(0,242,255,0.1));
        border: 1px solid rgba(118,131,255,0.3);
        border-radius: 16px;
        padding: 16px 24px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(12px);
        flex-wrap: wrap;
        gap: 16px;
        max-width: 1100px;
        margin-left: auto;
        margin-right: auto;
    }

    .student-topbar-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .student-topbar-logo {
        font-size: 1.3rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .student-topbar-nav {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .student-topbar-nav a {
        color: var(--muted-2);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        padding: 8px 16px;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .student-topbar-nav a:hover {
        background: rgba(255,255,255,0.15);
        color: var(--text);
        transform: translateY(-2px);
    }

    .student-topbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .student-stats-mini {
        display: flex;
        gap: 16px;
        align-items: center;
    }

    .stat-mini {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(0,0,0,0.3);
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .stat-mini-value {
        color: var(--accent);
    }

    .student-logout-btn {
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(255,77,77,0.2), rgba(255,107,157,0.2));
        border: 1px solid rgba(255,107,157,0.3);
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s ease;
    }

    .student-logout-btn:hover {
        background: linear-gradient(135deg, rgba(255,77,77,0.3), rgba(255,107,157,0.3));
        transform: translateY(-2px);
    }

    .dashboard-wrapper {
        max-width: 1100px;
        margin: 0 auto;
        padding: 40px 20px 80px;
        text-align: center;
    }

    .page-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--muted);
        text-shadow: 0 0 20px var(--shadow-soft);
    }

    .character-section {
        margin-top: 40px;
        margin-bottom: 40px;
    }

    .character-img {
        width: 260px;
        height: auto;
        animation: float 4s ease-in-out infinite;
        filter: drop-shadow(0 0 25px rgba(0,0,0,0.6));
    }

    @keyframes float {
        0% { transform: translateY(0); }
        50% { transform: translateY(-12px); }
        100% { transform: translateY(0); }
    }

    .character-name {
        font-size: 1.8rem;
        margin-top: 12px;
        color: var(--gold);
        text-shadow: 0 0 12px var(--gold);
    }

    .btn-main {
        margin-top: 18px;
        display: inline-block;
        padding: 14px 40px;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
        background: linear-gradient(135deg, var(--primary), var(--primary-2));
        border-radius: 10px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 8px 24px var(--shadow-soft);
    }

    .btn-main:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px var(--shadow-strong);
    }

    .btn-main:active {
        transform: translateY(-1px);
    }

    .stats-grid {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 50px;
        flex-wrap: wrap;
    }

    .stat-box {
        background: var(--glass-1);
        border: 1px solid var(--border-soft);
        padding: 25px 40px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
        width: 200px;
        text-align: center;
        transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    }

    .stat-box:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 12px 36px var(--shadow-soft), inset 0 0 20px var(--glass-1);
        border-color: var(--border-mid);
    }

    .stat-box h3 {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--muted-2);
        font-weight: 600;
        margin: 0 0 10px 0;
    }

    .stat-box p {
        font-size: 2.2rem;
        font-weight: 900;
        background: linear-gradient(135deg, var(--pink), var(--gold));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
    }

    .section-title {
        margin-top: 70px;
        margin-bottom: 24px;
        font-size: 2rem;
        font-weight: 800;
        color: var(--text);
        position: relative;
        padding-bottom: 12px;
    }

    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        border-radius: 2px;
        box-shadow: 0 0 12px var(--shadow-strong);
    }

    .missions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 25px;
        padding-bottom: 50px;
    }

    .mission-card {
        background: var(--glass-1);
        border: 1px solid var(--border-mid);
        padding: 25px 20px;
        border-radius: 14px;
        backdrop-filter: blur(10px);
        text-decoration: none;
        color: var(--muted);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
    }

    .mission-card::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, transparent 30%, var(--glass-1), transparent 70%);
        opacity: 0;
        transform: translateX(-100%);
        transition: transform 0.6s ease;
        pointer-events: none;
    }

    .mission-card:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 12px 40px var(--shadow-soft), inset 0 0 20px var(--glass-1);
        border-color: var(--border-mid);
    }

    .mission-card:hover::before {
        transform: translateX(100%);
    }

    .mission-card h3 {
        margin: 0 0 8px 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
    }

    .mission-card p {
        margin: 0;
        font-size: 0.9rem;
        color: var(--muted-2);
    }
</style>

<!-- Student Top Navigation -->
<div class="student-topbar">
    <div class="student-topbar-left">
        <div class="student-topbar-logo">üöÄ CozmicLearning</div>
        <div class="student-topbar-nav">
            <a href="/dashboard">üè† Dashboard</a>
            <a href="/subjects">üåå Explore</a>
            <a href="/arcade">üéÆ Arcade</a>
            <a href="/student/assignments">üìù Assignments</a>
        </div>
    </div>
    <div class="student-topbar-right">
        <div class="student-stats-mini">
            <div class="stat-mini">
                ‚≠ê <span class="stat-mini-value">{{ xp }}</span> XP
            </div>
            <div class="stat-mini">
                üéØ <span class="stat-mini-value">Lvl {{ level }}</span>
            </div>
            <div class="stat-mini">
                üî• <span class="stat-mini-value">{{ streak }}</span> Day
            </div>
        </div>
        <a href="/logout" class="student-logout-btn">Logout</a>
    </div>
</div>

<div class="dashboard-wrapper fade-in">

    <h1 class="page-title">Student Dashboard</h1>

    {% if character %}
    <div class="character-section">
        <img src="/static/characters/{{ character }}.png" class="character-img">
        <div class="character-name">{{ character.replace('_',' ').title() }}</div>

        <!-- FIXED ROUTE -->
        <a href="/subjects" class="btn-main">Begin Learning</a>
    </div>
    {% endif %}

    {% if time_limit_active and minutes_remaining is not none %}
    <!-- Time Limit Countdown (Phase 3) -->
    <div style="max-width: 600px; margin: 30px auto 20px; padding: 20px; background: linear-gradient(135deg, rgba(255, 159, 0, 0.15), rgba(255, 111, 216, 0.12)); border: 2px solid rgba(255, 159, 0, 0.4); border-radius: 16px; text-align: center;">
        <div style="font-size: 0.9rem; color: #8a92b3; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">‚è∞ Time Remaining Today</div>
        <div style="font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #ff9f00, #ff6fd8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px;">
            <span id="countdown-display">{{ minutes_remaining }} min</span>
        </div>
        <div style="width: 100%; height: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 6px; overflow: hidden; margin-top: 12px;">
            <div id="time-progress-bar" style="height: 100%; background: linear-gradient(90deg, #84ff00, #47c8ff); transition: width 0.5s ease; width: {{ (minutes_remaining / daily_limit * 100)|int }}%;"></div>
        </div>
        <div style="font-size: 0.85rem; color: #8a92b3; margin-top: 8px;">Daily limit: {{ daily_limit }} minutes</div>
    </div>

    <script>
        // Live countdown timer (Phase 3)
        let minutesRemaining = {{ minutes_remaining }};
        const dailyLimit = {{ daily_limit }};
        
        function updateCountdown() {
            const display = document.getElementById('countdown-display');
            const progressBar = document.getElementById('time-progress-bar');
            
            if (minutesRemaining > 0) {
                display.textContent = minutesRemaining + ' min';
                const percentRemaining = (minutesRemaining / dailyLimit) * 100;
                progressBar.style.width = percentRemaining + '%';
                
                // Change color as time runs low
                if (percentRemaining < 10) {
                    progressBar.style.background = 'linear-gradient(90deg, #ff453a, #ff6b9d)';
                } else if (percentRemaining < 25) {
                    progressBar.style.background = 'linear-gradient(90deg, #ff9f00, #ffbd2e)';
                }
            } else {
                display.textContent = 'Time\'s up!';
                progressBar.style.width = '0%';
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            }
        }
        
        // Update every minute
        setInterval(() => {
            minutesRemaining--;
            updateCountdown();
        }, 60000);
    </script>
    {% endif %}

    <div class="stats-grid">
        <div class="stat-box"><h3>XP</h3><p>{{ xp }}</p></div>
        <div class="stat-box"><h3>Level</h3><p>{{ level }}</p></div>
        <div class="stat-box"><h3>Tokens</h3><p>{{ tokens }}</p></div>
        <div class="stat-box"><h3>Streak</h3><p>{{ streak }} Days</p></div>
        {% if achievements %}
        <div class="stat-box"><h3>Badges</h3><p>{{ achievements|length }}</p></div>
        {% endif %}
        {% if show_usage %}
        <div class="stat-box" style="{% if questions_remaining < 20 %}border: 2px solid #ff9800;{% endif %}">
            <h3>Questions</h3>
            <p>{{ questions_used }}/{{ questions_limit }}</p>
            {% if questions_remaining < 20 %}
            <small style="color: #ff9800; font-size: 0.8em; display: block; margin-top: 5px;">
                {{ questions_remaining }} left
            </small>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    {% if show_usage and questions_remaining < 10 %}
    <div style="background: rgba(255, 152, 0, 0.1); border: 1px solid #ff9800; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 600px; text-align: center;">
        <p style="margin: 0; color: #ff9800;">
            ‚ö†Ô∏è You're running low on questions ({{ questions_remaining }} remaining). 
            <a href="/plans" style="color: #ff9800; text-decoration: underline;">Upgrade to Premium</a> for unlimited access!
        </p>
    </div>
    {% endif %}
    
    <!-- NEW: Achievements Section -->
    {% if achievements %}
    <h2 class="section-title" style="margin-top: 50px;">üèÜ Recent Achievements</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 900px; margin: 0 auto 30px;">
        {% for item in achievements[:6] %}
        <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.08)); border: 2px solid rgba(255,215,0,0.4); border-radius: 12px; padding: 15px; text-align: center; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-5px) scale(1.05)'; this.style.boxShadow='0 8px 24px rgba(255,215,0,0.3)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none';">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">{{ item.achievement.icon }}</div>
            <div style="font-weight: 700; color: #ffd700; font-size: 0.95rem; margin-bottom: 4px;">{{ item.achievement.name }}</div>
            <div style="font-size: 0.8rem; color: var(--muted-2);">{{ item.achievement.description }}</div>
            <div style="font-size: 0.75rem; color: var(--muted-2); margin-top: 6px; opacity: 0.7;">{{ item.earned_at.strftime('%b %d, %Y') }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- NEW: Recent Activity Feed -->
    {% if recent_activities %}
    <h2 class="section-title" style="margin-top: 40px;">üìä Recent Activity</h2>
    <div style="max-width: 700px; margin: 0 auto 40px; background: var(--glass-1); border: 1px solid var(--border-soft); border-radius: 14px; padding: 20px; backdrop-filter: blur(10px);">
        {% for activity in recent_activities %}
        <div style="display: flex; align-items: center; gap: 15px; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); transition: all 0.2s ease;" onmouseover="this.style.background='rgba(255,255,255,0.05)';" onmouseout="this.style.background='transparent';">
            <div style="font-size: 1.5rem; flex-shrink: 0;">
                {% if activity.activity_type == 'question_answered' %}üìù
                {% elif activity.activity_type == 'assignment_completed' %}‚úÖ
                {% elif activity.activity_type == 'achievement_earned' %}üèÜ
                {% elif activity.activity_type == 'level_up' %}‚¨ÜÔ∏è
                {% else %}‚≠ê{% endif %}
            </div>
            <div style="flex-grow: 1;">
                <div style="font-size: 0.9rem; color: var(--text); margin-bottom: 2px;">{{ activity.description }}</div>
                <div style="font-size: 0.75rem; color: var(--muted-2);">
                    {{ activity.created_at.strftime('%b %d at %I:%M %p') }}
                    {% if activity.subject %} ‚Ä¢ {{ activity.subject.replace('_', ' ').title() }}{% endif %}
                </div>
            </div>
            {% if activity.xp_earned > 0 %}
            <div style="background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.15)); padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; color: #ffd700;">
                +{{ activity.xp_earned }} XP
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <script>
        // Show character comment and celebration on dashboard load
        window.addEventListener('load', () => {
            const character = '{{ character }}' || 'everly';
            const streak = {{ streak }};
            
            // Show newly unlocked achievements
            {% if newly_unlocked %}
            {% for achievement in newly_unlocked %}
            setTimeout(() => {
                CozmicEnhancements.showAchievementUnlock(
                    '{{ achievement.icon }}',
                    '{{ achievement.name }}',
                    '{{ achievement.description }}'
                );
            }, {{ loop.index0 * 2000 }});
            {% endfor %}
            {% endif %}
            
            // Show character personality comment
            if (streak > 1) {
                CozmicEnhancements.showCharacterComment('streakCongrats', character);
            } else {
                CozmicEnhancements.showCharacterComment('encouragement', character);
            }
            
            // Light celebration for returning user
            {% if newly_unlocked %}
            CozmicEnhancements.launchConfetti(30);
            {% else %}
            CozmicEnhancements.launchConfetti(15);
            {% endif %}
        });
    </script>
    
    <!-- NEW: Progress Charts -->
    {% if progress_data and progress_data.dates %}
    <h2 class="section-title" style="margin-top: 40px;">üìà Your Progress</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; max-width: 1000px; margin: 0 auto 40px;">
        <!-- XP Over Time Chart -->
        <div style="background: var(--glass-1); border: 1px solid var(--border-soft); border-radius: 14px; padding: 25px; backdrop-filter: blur(10px);">
            <h3 style="margin: 0 0 20px 0; font-size: 1.1rem; color: var(--text);">üìä Weekly XP</h3>
            <canvas id="xpChart" style="max-height: 220px;"></canvas>
        </div>
        
        <!-- Subject Activity Chart -->
        {% if progress_data.subjects %}
        <div style="background: var(--glass-1); border: 1px solid var(--border-soft); border-radius: 14px; padding: 25px; backdrop-filter: blur(10px);">
            <h3 style="margin: 0 0 20px 0; font-size: 1.1rem; color: var(--text);">üåç Subject Explorer</h3>
            <canvas id="subjectChart" style="max-height: 220px;"></canvas>
        </div>
        {% endif %}
    </div>
    
    <script>
        // XP Progress Chart
        const xpCtx = document.getElementById('xpChart');
        if (xpCtx) {
            new Chart(xpCtx, {
                type: 'line',
                data: {
                    labels: {{ progress_data.dates | tojson }},
                    datasets: [{
                        label: 'XP Earned',
                        data: {{ progress_data.xp | tojson }},
                        borderColor: '#00f2ff',
                        backgroundColor: 'rgba(0, 242, 255, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00f2ff',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(10, 14, 39, 0.95)',
                            titleColor: '#00f2ff',
                            bodyColor: '#fff',
                            borderColor: '#00f2ff',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#8a92b3', font: { size: 11 } }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#8a92b3', font: { size: 11 } }
                        }
                    }
                }
            });
        }
        
        // Subject Distribution Chart
        const subjectCtx = document.getElementById('subjectChart');
        if (subjectCtx) {
            const subjectData = {{ progress_data.subjects | tojson }};
            new Chart(subjectCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(subjectData),
                    datasets: [{
                        data: Object.values(subjectData),
                        backgroundColor: [
                            '#5c6bff', '#00f2ff', '#ff6fd8', '#ffdd55',
                            '#4caf50', '#c084fc', '#ff9500', '#ff6b6b',
                            '#84ff00', '#47c8ff', '#ffd700'
                        ],
                        borderColor: 'rgba(10, 14, 39, 0.8)',
                        borderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#8a92b3',
                                font: { size: 10 },
                                padding: 10,
                                boxWidth: 12,
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 14, 39, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#5c6bff',
                            borderWidth: 1,
                            padding: 12,
                        }
                    }
                }
            });
        }
    </script>
    {% endif %}

    <!-- NEW: Daily Goals & Challenges -->
    <h2 class="section-title" style="margin-top: 50px;">üéØ Daily Goals & Challenges</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto 40px;">
        <!-- XP Goal -->
        <div style="background: linear-gradient(135deg, rgba(92,107,255,0.12), rgba(0,242,255,0.08)); border: 2px solid rgba(92,107,255,0.3); border-radius: 14px; padding: 20px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='rgba(92,107,255,0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(92,107,255,0.3)'">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 2rem;">‚≠ê</div>
                <div>
                    <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600;">XP Goal Today</div>
                    <div style="font-size: 1.3rem; font-weight: 800; color: var(--accent);">{% set daily_xp_goal = 100 %}{% set today_xp = xp % 100 %}{{ today_xp }}/{{ daily_xp_goal }}</div>
                </div>
            </div>
            <div style="width: 100%; height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: linear-gradient(90deg, #5c6bff, #00f2ff); width: {{ (today_xp / daily_xp_goal * 100)|int if today_xp < daily_xp_goal else 100 }}%; transition: width 0.5s ease;"></div>
            </div>
        </div>

        <!-- Questions Goal -->
        <div style="background: linear-gradient(135deg, rgba(132,255,0,0.12), rgba(0,200,83,0.08)); border: 2px solid rgba(132,255,0,0.3); border-radius: 14px; padding: 20px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='rgba(132,255,0,0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(132,255,0,0.3)'">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 2rem;">üìù</div>
                <div>
                    <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600;">Questions Today</div>
                    <div style="font-size: 1.3rem; font-weight: 800; color: var(--success);">{% set daily_q_goal = 10 %}{% set today_questions = 3 %}{{ today_questions }}/{{ daily_q_goal }}</div>
                </div>
            </div>
            <div style="width: 100%; height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; overflow: hidden;">
                <div style="height: 100%; background: linear-gradient(90deg, #84ff00, #00c853); width: {{ (today_questions / daily_q_goal * 100)|int }}%; transition: width 0.5s ease;"></div>
            </div>
        </div>

        <!-- Streak Challenge -->
        <div style="background: linear-gradient(135deg, rgba(255,159,0,0.12), rgba(255,111,216,0.08)); border: 2px solid rgba(255,159,0,0.3); border-radius: 14px; padding: 20px; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='rgba(255,159,0,0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(255,159,0,0.3)'">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div style="font-size: 2rem;">üî•</div>
                <div>
                    <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600;">Keep the Streak!</div>
                    <div style="font-size: 1.3rem; font-weight: 800; color: var(--warning);">{{ streak }} Days</div>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: var(--muted-2);">Come back tomorrow to continue! üöÄ</div>
        </div>
    </div>

    <!-- NEW: Quick Access to Favorite Subjects -->
    <h2 class="section-title" style="margin-top: 40px;">‚ö° Quick Launch</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; max-width: 1000px; margin: 0 auto 40px;">
        <a href="/ask-question?subject=num_forge" style="background: linear-gradient(135deg, rgba(255,107,157,0.15), rgba(199,68,124,0.1)); border: 2px solid rgba(255,107,157,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(255,107,157,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">üî¢</div>
            <div style="font-weight: 700; color: var(--pink); margin-bottom: 4px;">Math</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Num Forge</div>
        </a>

        <a href="/ask-question?subject=story_verse" style="background: linear-gradient(135deg, rgba(79,172,254,0.15), rgba(0,242,255,0.1)); border: 2px solid rgba(79,172,254,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(79,172,254,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">üìñ</div>
            <div style="font-weight: 700; color: var(--accent-2); margin-bottom: 4px;">Reading</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Story Verse</div>
        </a>

        <a href="/ask-question?subject=atom_sphere" style="background: linear-gradient(135deg, rgba(132,255,0,0.15), rgba(0,200,83,0.1)); border: 2px solid rgba(132,255,0,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(132,255,0,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">üî¨</div>
            <div style="font-weight: 700; color: var(--success); margin-bottom: 4px;">Science</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Atom Sphere</div>
        </a>

        <a href="/ask-question?subject=chrono_core" style="background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,165,0,0.1)); border: 2px solid rgba(255,215,0,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(255,215,0,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">üèõÔ∏è</div>
            <div style="font-weight: 700; color: var(--gold); margin-bottom: 4px;">History</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Chrono Core</div>
        </a>

        <a href="/ask-question?subject=ink_haven" style="background: linear-gradient(135deg, rgba(192,132,252,0.15), rgba(139,92,246,0.1)); border: 2px solid rgba(192,132,252,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(192,132,252,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">‚úçÔ∏è</div>
            <div style="font-weight: 700; color: #c084fc; margin-bottom: 4px;">Writing</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Ink Haven</div>
        </a>

        <a href="/arcade" style="background: linear-gradient(135deg, rgba(255,107,157,0.15), rgba(79,172,254,0.15)); border: 2px solid rgba(255,107,157,0.4); border-radius: 12px; padding: 20px; text-decoration: none; text-align: center; transition: all 0.3s ease; display: block;" onmouseover="this.style.transform='translateY(-8px) scale(1.05)'; this.style.boxShadow='0 12px 30px rgba(255,107,157,0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none'">
            <div style="font-size: 2.5rem; margin-bottom: 8px;">üéÆ</div>
            <div style="font-weight: 700; color: var(--pink); margin-bottom: 4px;">Arcade</div>
            <div style="font-size: 0.75rem; color: var(--muted-2);">Play Games</div>
        </a>
    </div>

    <!-- NEW: Upcoming Assignments Preview -->
    {% if False %}  <!-- Will be populated when assignments exist -->
    <h2 class="section-title" style="margin-top: 40px;">üìÖ Upcoming Assignments</h2>
    <div style="max-width: 800px; margin: 0 auto 40px;">
        <div style="background: var(--glass-1); border: 1px solid var(--border-soft); border-radius: 14px; padding: 20px; backdrop-filter: blur(10px);">
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ff6b9d, #c44569); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üìù</div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 700; color: var(--text); margin-bottom: 4px;">Math Practice: Fractions</div>
                    <div style="font-size: 0.85rem; color: var(--muted-2);">Due: Tomorrow ‚Ä¢ 10 questions</div>
                </div>
                <a href="/student/assignments" style="padding: 8px 16px; background: linear-gradient(135deg, var(--primary), var(--primary-2)); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 0.9rem;">Start</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- NEW: Learning Insights Summary -->
    <h2 class="section-title" style="margin-top: 40px;">üí° Your Learning Insights</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto 40px;">
        <!-- Strength Area -->
        <div style="background: linear-gradient(135deg, rgba(132,255,0,0.12), rgba(0,200,83,0.08)); border: 2px solid rgba(132,255,0,0.3); border-radius: 14px; padding: 24px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 12px;">üí™</div>
            <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600; margin-bottom: 8px;">YOUR STRENGTH</div>
            <div style="font-size: 1.4rem; font-weight: 800; color: var(--success); margin-bottom: 4px;">Mathematics</div>
            <div style="font-size: 0.85rem; color: var(--muted-2);">95% average accuracy</div>
        </div>

        <!-- Growth Area -->
        <div style="background: linear-gradient(135deg, rgba(255,159,0,0.12), rgba(255,111,216,0.08)); border: 2px solid rgba(255,159,0,0.3); border-radius: 14px; padding: 24px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 12px;">üå±</div>
            <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600; margin-bottom: 8px;">GROWTH OPPORTUNITY</div>
            <div style="font-size: 1.4rem; font-weight: 800; color: var(--warning); margin-bottom: 4px;">History</div>
            <div style="font-size: 0.85rem; color: var(--muted-2);">More practice recommended</div>
        </div>

        <!-- Study Time -->
        <div style="background: linear-gradient(135deg, rgba(79,172,254,0.12), rgba(0,242,255,0.08)); border: 2px solid rgba(79,172,254,0.3); border-radius: 14px; padding: 24px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 12px;">‚è∞</div>
            <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600; margin-bottom: 8px;">THIS WEEK</div>
            <div style="font-size: 1.4rem; font-weight: 800; color: var(--accent); margin-bottom: 4px;">2.5 Hours</div>
            <div style="font-size: 0.85rem; color: var(--muted-2);">Learning time logged</div>
        </div>

        <!-- Recommendation -->
        <div style="background: linear-gradient(135deg, rgba(192,132,252,0.12), rgba(139,92,246,0.08)); border: 2px solid rgba(192,132,252,0.3); border-radius: 14px; padding: 24px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 12px;">üéØ</div>
            <div style="font-size: 0.85rem; color: var(--muted-2); font-weight: 600; margin-bottom: 8px;">RECOMMENDED</div>
            <div style="font-size: 1.4rem; font-weight: 800; color: #c084fc; margin-bottom: 4px;">Science Lab</div>
            <div style="font-size: 0.85rem; color: var(--muted-2);">Ready for next level</div>
        </div>
    </div>

    <!-- Motivational Message -->
    <div style="max-width: 700px; margin: 40px auto; padding: 25px; background: linear-gradient(135deg, rgba(92,107,255,0.15), rgba(0,242,255,0.1)); border: 2px solid rgba(92,107,255,0.4); border-radius: 16px; text-align: center;">
        <div style="font-size: 1.8rem; margin-bottom: 12px;">‚ú®</div>
        <div style="font-size: 1.2rem; font-weight: 700; color: var(--text); margin-bottom: 8px;">
            {% set motivational_messages = [
                "You're making amazing progress!",
                "Keep up the fantastic work!",
                "Your dedication is inspiring!",
                "Every question brings you closer to mastery!",
                "You're on fire today!",
                "Learning looks great on you!",
                "Your future is bright!"
            ] %}
            {{ motivational_messages[xp % motivational_messages|length] }}
        </div>
        <div style="font-size: 0.9rem; color: var(--muted-2); line-height: 1.6;">
            You've answered {{ xp // 10 }} questions this month. Each one makes you smarter! üß†
        </div>
    </div>

    <h2 class="section-title">üöÄ Today's Missions</h2>

    <div class="missions-grid">
        <a href="/ask-question?subject=num_forge" class="mission-card">
            <h3>Math Mission</h3><p>Solve a new challenge.</p>
        </a>

        <a href="/ask-question?subject=story_verse" class="mission-card">
            <h3>Reading Adventure</h3><p>Summaries and decoding.</p>
        </a>

        <a href="/ask-question?subject=ink_haven" class="mission-card">
            <h3>Writing Quest</h3><p>Practice and feedback.</p>
        </a>

        <a href="/ask-question?subject=atom_sphere" class="mission-card">
            <h3>Science Lab</h3><p>Ask about experiments.</p>
        </a>

        <a href="/ask-question?subject=chrono_core" class="mission-card">
            <h3>History Quest</h3><p>Explore the past.</p>
        </a>

        <a href="/ask-question?subject=faith_realm" class="mission-card">
            <h3>Faith Realm</h3><p>Ask Bible questions.</p>
        </a>
    </div>

</div>

{% endblock %}
